<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç¶ –¢–ï–°–¢</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .container {
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        h1 {
            color: #1a2639;
            font-size: 32px;
            margin-bottom: 40px;
        }
        .test-btn {
            background: linear-gradient(135deg, #4a6fa5 0%, #3a5a8a 100%);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
            box-shadow: 0 8px 20px rgba(74, 111, 165, 0.3);
        }
        .test-btn:hover {
            transform: scale(0.98);
        }
        .test-btn.small {
            font-size: 18px;
            padding: 15px 30px;
            background: linear-gradient(135deg, #51c585 0%, #3aa36a 100%);
        }
        .status {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
            font-size: 16px;
            color: #333;
            border: 1px solid #ddd;
        }
        .log {
            background: #1e1e1e;
            color: #0f0;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            text-align: left;
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç¶ –¢–ï–°–¢–û–í–´–ô –ú–ê–ì–ê–ó–ò–ù</h1>

        <!-- –û–ì–†–û–ú–ù–ê–Ø –ö–ù–û–ü–ö–ê -->
        <button class="test-btn" onclick="sendTest()">
            üî• –ù–ê–ñ–ú–ò –ú–ï–ù–Ø üî•
        </button>

        <!-- –ö–ù–û–ü–ö–ê –ü–û–ú–ï–ù–¨–®–ï -->
        <button class="test-btn small" onclick="sendProducts()">
            üì¶ –ó–ê–ü–†–û–°–ò–¢–¨ –¢–û–í–ê–†–´
        </button>

        <!-- –°–¢–ê–¢–£–° -->
        <div class="status">
            <div id="status">‚úÖ –ì–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ</div>
            <div id="userInfo"></div>
        </div>

        <!-- –õ–û–ì–ò -->
        <div class="log" id="log">
            üìã –õ–æ–≥–∏ WebApp:
        </div>
    </div>

    <script>
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const logDiv = document.getElementById('log');
        const statusDiv = document.getElementById('status');
        const userDiv = document.getElementById('userInfo');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        if (tg.initDataUnsafe?.user) {
            const user = tg.initDataUnsafe.user;
            userDiv.innerHTML = `
                üë§ ID: ${user.id}<br>
                üìù –ò–º—è: ${user.first_name}<br>
                üîó –ë–æ—Ç: @kurevo1bot
            `;
        }

        // ========== –§–£–ù–ö–¶–ò–Ø –õ–û–ì–ì–ò–†–û–í–ê–ù–ò–Ø ==========
        function addLog(text) {
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<br>[${time}] ${text}`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(text);
        }

        // ========== –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• ==========
        function sendToBot(data) {
            const payload = JSON.stringify(data);

            addLog(`üì§ –û–¢–ü–†–ê–í–ö–ê: ${payload}`);
            addLog(`ü§ñ –ë–æ—Ç: @kurevo1bot`);

            statusDiv.innerHTML = `üì§ –û—Ç–ø—Ä–∞–≤–∫–∞...`;
            statusDiv.style.color = 'orange';

            try {
                tg.sendData(payload);
                addLog(`‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!`);
                statusDiv.innerHTML = `‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!`;
                statusDiv.style.color = 'green';
            } catch (e) {
                addLog(`‚ùå –û–®–ò–ë–ö–ê: ${e.message}`);
                statusDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${e.message}`;
                statusDiv.style.color = 'red';
            }
        }

        // ========== –ö–ù–û–ü–ö–ê 1 ==========
        function sendTest() {
            addLog(`üî• –ù–ê–ñ–ê–¢–ê –¢–ï–°–¢–û–í–ê–Ø –ö–ù–û–ü–ö–ê`);
            sendToBot({
                action: 'test',
                message: '–ü—Ä–∏–≤–µ—Ç –æ—Ç WebApp!',
                timestamp: new Date().toISOString()
            });
        }

        // ========== –ö–ù–û–ü–ö–ê 2 ==========
        function sendProducts() {
            addLog(`üì¶ –ó–ê–ü–†–û–° –¢–û–í–ê–†–û–í`);
            sendToBot({
                action: 'get_products'
            });
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–í–ï–¢–ê ==========
        tg.onEvent('webAppData', (event) => {
            addLog(`üì• –û–¢–í–ï–¢ –û–¢ –ë–û–¢–ê: ${event.data}`);
            try {
                const data = JSON.parse(event.data);
                addLog(`‚úÖ –†–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: ${JSON.stringify(data)}`);
                statusDiv.innerHTML = `‚úÖ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç!`;
            } catch (e) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ${e.message}`);
            }
        });

        addLog(`üöÄ WebApp –∑–∞–≥—Ä—É–∂–µ–Ω`);
        addLog(`ü§ñ –ë–æ—Ç: @kurevo1bot`);
        addLog(`üîó initData: ${tg.initData ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}`);
    </script>
</body>
</html>